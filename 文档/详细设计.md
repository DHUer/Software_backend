# 一、程序系统的结构

​		针对概要设计部分的说明，针对每个模块进一步细化，明确内部结构和实现细节。方便后期测试时进行调试和复查。

## 1.1 创建用户模块设计说明

#### 1.1.1 程序描述

​		用户初次登陆小程序需要获取唯一标识以记录登陆状态，以及在数据库中生成条目用以记录用户后续在小程序中一系列操作。

#### 1.1.2 功能

​		由于微信对小程序开发的安全性有较高要求，因此用户信息的解码无法在前端直接进行，只能在前端获取code，然后在后端，附带开发者的基本信息调用微信的api接口来获取解码信息。

​		用户的基本标识不能直接明文传输，因此加密以后作为数据库用户表的主键并传回前端。此后涉及用户的数据操作，前端都需要附带用户的唯一标识。

![1560426280263](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560426280263.png)

#### 1.1.3 性能

​		时间：由于用户登陆授权后，需要及时得到唯一标识并允许用户进行后续操作，因此对于服务器获取解码信息的响应要求较高。

#### 1.1.4 输入项

| 名称     | 标识 | 类型 | 输入方式       |
| -------- | ---- | ---- | -------------- |
| 用户编码 | code | json | 附在http请求中 |

#### 1.1.5 输出项

| 名称   | 标识 | 类型   | 输出方式           |
| ------ | ---- | ------ | ------------------ |
| 用户id | uid  | string | 附在httpResponse中 |

#### 1.1.6 算法

​		使用了python自带的md5加密算法对所有用户的唯一标识进行加密。

#### 1.1.7 流程逻辑

​		整个获取流程如下图所示。

![Untitled Diagram(7)](C:\Users\Administrator\Downloads\Untitled Diagram(7).png)

## 1.2 推荐文章模块设计说明

####  1.2.1 程序描述

​		该模块主要实现了针对用户的词汇量以及对不同词库（四六级等）词汇掌握情况推荐最适合阅读的文章的功能。

#### 1.2.2 功能

​		用户获取推荐文章的前提是已经做过词汇测试，如果做过多轮词汇测试则取最新的结果。而文章根据后台管理者的需求，可以设置只取近3天（或者任意）的文章进行推荐。

![1560428756019](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560428756019.png)

#### 1.2.3 性能

​		时间特性：用户做完词汇测试后应当立即就能看到推荐文章，等待时间过长会影响用户体验，因此要求后端进行数据处理时，不能消耗过长时间，如果数据库中的文章条目过多，后台管理员应该设计一个取数据范围。

#### 1.2.4 输入项

| 名称   | 标识 | 类型   | 输入方式       |
| ------ | ---- | ------ | -------------- |
| 用户id | uid  | string | 附在http请求中 |

#### 1.2.5 输出项

| 名称     | 标识     | 类型 | 输出方式       |
| -------- | -------- | ---- | -------------- |
| 推荐文章 | articles | dict | httpresponse中 |

#### 1.2.6 算法

​		主要用到了欧式距离来计算用户词汇覆盖度和文章词汇覆盖度之间近似程度。

![1560429152141](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560429152141.png)

#### 1.2.7 流程逻辑

​		当用户进入推荐模块才会判断是否做过词汇测试，若用户刚进入小程序，并且没有用到推荐功能，则不会要求进行词汇测试。

![1560429632657](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560429632657.png)

#### 1.2.8 接口

​		若用户未做过词汇测试并想使用推荐功能，则调用词汇测试模块。

## 1.3 词汇测试模块设计说明

#### 1.3.1  程序描述

​		不同的用户掌握的词汇不尽相同，有的用户可能掌握的四级词汇较多，有的可能掌握的六级词汇较多， 该模块主要用于对用户的词汇覆盖程度做一定的度量（度量的标准有四级，六级，托福，雅思等），得出的结果是系统个性化推荐文章的重要依据。

#### 1.3.2 功能

​		首先获取用户id，因为测试的结果需要和用户绑定。用户使用该功能后，后端在每个词库中分别随机化抽取词汇，返回前端。

​		用户对每个单词进行判断，如果认识则选择“认识”，不认识则选择“不认识”，最后将认识的词汇数/该词库抽取的总词数，该比例可以指代用户对于该词库的掌握程度。该数据由前端统计后返回后端并存入数据库。

​		同时，用户在测试完以后可以查看不认识的词汇进行复习巩固。

![1560432663646](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560432663646.png)

#### 1.3.3 性能

​		精度：用户词汇掌握程度的结果取浮点数，小数点后两位即可。

​		灵活性：由于随机生成的测试词汇比较多，因此，应当允许用户随时停止测试，并对未测试的数据做出随机化处理。

#### 1.3.4 输入项

| 名称   | 标识 | 数据类型 | 输入方式 |
| ------ | ---- | -------- | -------- |
| 用户id | uid  | string   | http请求 |

#### 1.3.5 输出项

| 名称       | 标识            | 数据类型 | 输出方式     |
| ---------- | --------------- | -------- | ------------ |
| 词汇覆盖度 | cover_rate_list | list     | http请求     |
| 测试词汇   | test_words      | dict     | httpResponse |

#### 1.3.6 算法

​		获取的词库以及词库词汇数量如下：

| 词库 | cet4 | cet6 | 高中 | GRE  | IELTS | 考研 | 托福 |
| ---- | ---- | ---- | ---- | ---- | ----- | ---- | ---- |
| 词数 | 4616 | 2088 | 3933 | 6495 | 6555  | 5325 | 5395 |

​		按照一定的比例从每个词库中随机抽取单词（该比例可有后台开发者自定），若从六级词库中抽取10个词，用户进行测试后，认识6个词，那么可以估计用户对于四级词汇的掌握程度为0.6。其他的词库掌握情况以此类推。

#### 1.3.7 流程逻辑

![1560434541788](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560434541788.png)

#### 1.3.8尚未解决的问题

​		有的词库中抽取的词汇可能会和其他词库重合（但是概览较低），因此最保险的做法是在随机抽取词汇时进行判定，若抽到了重复的数据则重新抽取。



## 1.4  获取新闻内容模块设计说明

#### 1.4.1程序描述

​		系统最重要的部分是对于数据的获取，我们使用scrapy框架来获取新闻内容以及其他相关信息。scrapy框架功能较为完整，只需要明确需要获取的页面元素即可自动化的爬取内容。

​		调用该程序后，模块会自动爬取当日所有条目下的新闻文章，并对数据做一定的处理，最后形成json文件存入本地。

​		工作人员手工将获取的新闻数据再存入数据库。

#### 1.4.2功能

​		获取了所有新闻数据后，需要清洗数据，将文本内容从string格式变成以单独词为单位的list列表，并且获得去重的文章单词信息，再将去重单词列表与词库相对比，查看文章内容针对每个词库的覆盖情况。

![1560435273183](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560435273183.png)

#### 1.4.3性能

* 时间特性：由于数据每日获取一次，对于获取的时间没有要求
* 灵活性：模块应当能够处理一定的错误，例如在请求过于频繁，ip地址被禁止以后能够切换ip。
* 精度：精度要求不高，但是要确保文章内容是准确的。

#### 1.4.4 输出项

| 名称         | 标识    | 数据类型 | 输出形式 |
| ------------ | ------- | -------- | -------- |
| 文章信息汇总 | news    | dict     | 本地文件 |
| 文章内容     | content | list     | 本地文件 |

#### 1.4.5 流程逻辑

![1560435923655](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560435923655.png)



## 1.5收藏文章模块设计说明

#### 1.5.1程序描述

​		该模块主要实现了用户收藏文章的功能，用户与文章是一对多的关系，一个用户可以收藏多篇文章，并且可以在”我的收藏“模块查看历史收藏。

#### 1.5.2功能

![1560437907182](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560437907182.png)

#### 1.5.3性能

精度：需要准确的记录用户收藏的文章信息以及收藏的日期。

#### 1.5.4输入项

| 名称   | 标识       | 类型    | 输入方式 |
| ------ | ---------- | ------- | -------- |
| 文章id | article_id | integer | http请求 |
| 用户id | user_id    | string  | http请求 |

#### 1.5.5流程逻辑

![1560438204735](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560438204735.png)

## 1.6 最近浏览模块设计说明

### 1.6.1 程序描述

​		该模块主要实现存储用户最近阅读的10篇文章记录的功能。

### 1.6.2 功能

​		由于最近浏览不存储过多数据，将用户每篇阅读完成的文章主键存储在数组中，再将该数组同步保存到小程序缓存中：wx.setStorageSync('seenList', temp)；查看浏览记录，则直接从缓存中同步获取wx.getStorageSync('seenList')

### 1.6.3 输出项

| 名称             | 标识         | 数据类型 | 输出方式   |
| ---------------- | ------------ | -------- | ---------- |
| 最近阅读文章列表 | article_list | list     | 从缓存中取 |

### 1.6.4 流程逻辑

![1560506279947](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560506279947.png)

## 1.7 背单词模块设计说明

### 1.7.1 程序描述

​		该模块主要实现了用户背单词的功能，每一个用户拥有的生词本存放在后台的服务器中。背单词的过程中，程序会随机以卡片的形式展示生词本中的莫一个单词，用户对当前卡片所展示的单词有两个选项，认识和不认识。如果用户不认识该单词可以单击单词卡片上的“查看详细释义”，之后便可以看到单词的详细解释，包括双语例句，发音，以及词性。不认识的单词会多出现几遍。

### 1.7.2 功能

![1560505690639](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560505690639.png)

### 1.7.3 输入项

| 名称   | 标识   | 数据类型 | 输入方式           |
| ------ | ------ | -------- | ------------------ |
| 用户id | uid    | string   | http请求           |
| 认识   | Known  | event    | 用户触发认识按钮   |
| 不认识 | Unkown | event    | 用户触发不认识按钮 |

### 1.7.4 输出项

| 名称         | 标识            | 数据类型 | 输出方式   |
| ------------ | --------------- | -------- | ---------- |
| 认识单词数   | familiarWords   | int      | 小程序缓存 |
| 不认识单词数 | UnfamiliarWords | int      | 小程序缓存 |
| 背单词日期   | currentTime     | Date     | 小程序缓存 |

### 1.7.5 算法

背单词的过程中，每次用户单击不认识此单词的时候就将此不认识的单词放到一个栈中，当当前的栈空的时候开始背另一个栈，两个栈来回倒来实现背单词的功能，直到用户将单词背完。

![1560505913291](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560505913291.png)

### 1.7.6 流程逻辑

![1560505950113](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1560505950113.png)







## **1.8** **生词本模块说明分析**

### **1.8.1** **程序描述**

用户在阅读文章的过程中，可以添加单词到单词本中，单词本中的每一个单词在数据库中的存放形式是一个json的列表，列表里的每一个元素都是一个字典。字典数据的健是单词，值是被添加的次数。用户可以对单词本进行，增和删两种操作。

 

### **1.8.2** **功能**

![img](file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml8304\wps1.jpg) 

 

### **1.8.3** **输入项**

| 名称 | 标识符    | 数据类型 | 输入方式 |
| ---- | --------- | -------- | -------- |
| 0    | operation | int      | http     |
| 1    | operation | int      | http     |
| 2    | operation | int      | http     |

 

### **1.8.4 输出项**

| 名称 | 标识符    | 数据类型 | 输出方式 |
| ---- | --------- | -------- | -------- |
| 0    | operation | list     | http     |

 

### **1.8.5** 逻辑流程

添加生词业务逻辑

![img](file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml8304\wps2.jpg) 

获取所有生词/添加生词业务逻辑：

![img](file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml8304\wps3.jpg)